<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.6.33">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>New Outline for Chapter 3</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for citations */
      div.csl-bib-body { }
      div.csl-entry {
        clear: both;
        margin-bottom: 0em;
      }
      .hanging-indent div.csl-entry {
        margin-left:2em;
        text-indent:-2em;
      }
      div.csl-left-margin {
        min-width:2em;
        float:left;
      }
      div.csl-right-inline {
        margin-left:2em;
        padding-left:1em;
      }
      div.csl-indent {
        margin-left: 2em;
      }    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-545cdd561de3535e9b364c647f747893.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>   <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script> 
      </head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> New Outline for Chapter 3</h6>

            <a href="./chapt3_outline.qmd" class="btn btn-primary quarto-download-embed" download="chapt3_outline.qmd">Download Source</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">New Outline for Chapter 3</h1>
            <p class="subtitle lead">Atlantic Bluefin Tuna Area Transition Matrices Estimated From Electronic Tagging and SatTagSim</p>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
            <div class="quarto-title-meta-author">
          <div class="quarto-title-meta-heading">Authors</div>
          <div class="quarto-title-meta-heading">Affiliations</div>
          
                <div class="quarto-title-meta-contents">
            <p class="author">Benjamin Galuardi <a href="mailto:benjamin.galuardi@noaa.gov" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        School of Marine Science and Technology, University of Massachusetts Dartmouth, Fairhaven, MA, USA
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Steven X. Cadrin </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        School of Marine Science and Technology, University of Massachusetts Dartmouth, Fairhaven, MA, USA
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Igor Arregi </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        AZTI Technalia, Marine Research Division, Pasaia (Gipuzkoa), Spain
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Haritz Arrizabalaga </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        AZTI Technalia, Marine Research Division, Pasaia (Gipuzkoa), Spain
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Antonio DiNatale </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        ICCAT Secretariat, Madrid, Spain
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Craig Brown </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Southeast Fisheries Science Center, NOAA Fisheries, Miami, FL, USA
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Matt Lauretta </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Southeast Fisheries Science Center, NOAA Fisheries, Miami, FL, USA
                      </p>
                  </div>
                      <div class="quarto-title-meta-contents">
            <p class="author">Molly Lutcavage </p>
          </div>
                <div class="quarto-title-meta-contents">
                    <p class="affiliation">
                        Large Pelagics Research Center, Gloucester, MA, USA
                      </p>
                  </div>
                    </div>
        
        <div class="quarto-title-meta">

                      
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#elementssections" id="toc-elementssections" class="nav-link" data-scroll-target="#elementssections">elements/sections</a></li>
  <li><a href="#chapter-2-notes" id="toc-chapter-2-notes" class="nav-link" data-scroll-target="#chapter-2-notes">Chapter 2 notes</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <section id="summary" class="level1">
<h1>Summary</h1>
<p>We demonstrate use of a telemetry based method for simulating individual based movements to produce transition matrices for movement inclusive models. A custom R package (SatTagSim) was used on Atlantic bluefin tuna electronic tagging data from the Large Pelagics Research Center (UMass Boston), AZTI Technalia, the Grande Bluefin Year Program, and the National Marine Fisheries Service (USA) to derive transition matrices for an 11-box and 4-box model. Migration rate matrices were produced for western Atlantic tagged fish &gt;185cm, and &lt;185 cm, as well as for eastern tagged fish (all sizes). The estimates provided are fishery independent and external to the operational and assessment frameworks. The results are highly informative to the assessment by (1) providing estimates of bluefin tuna movement for consideration as fixed values, prior probabilities on movement, or for direct comparison with estimates of movement from mixed stock assessment models (2) to facilitate discussion of movement rate assumptions and the use of electronic tagging data in various assessment models.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The benchmark assessment of Atlantic Bluefin tuna (<em>Thunnus thynnus</em>) in 2017 offers a unique opportunity to take advantage of the wealth of electronic tagging data collected in the past 20+ years. <!--# this is old news. this should be updated -->The Grande Bluefin Year Program (GBYP), a project within the International Commission for the Conservation of Atlantic Tunas (ICCAT), in particular offers a source of tagging data originating in the eastern Atlantic that was not previously available. Management strategy evaluation (MSE) is a priority for Atlantic bluefin tuna management and is currently a funded initiative within ICCAT <span class="citation" data-cites="carruthers2014">(<a href="#ref-carruthers2014" role="doc-biblioref">Carruthers and Davies 2014</a>)</span>. Development of operating models is a key component to MSE and can be a vector for utilizing electronic tag data <span class="citation" data-cites="kerr2012a kerr2016 carruthers2016">(<a href="#ref-kerr2012a" role="doc-biblioref">Kerr, Cadrin, and Secor 2012a</a>, <a href="#ref-kerr2016" role="doc-biblioref">2012b</a>; <a href="#ref-carruthers2016" role="doc-biblioref">Carruthers et al. 2016a</a>)</span></p>
<p>There are several challenges in making these data usable in assessment activities. The first is to summarize the data in a way that is readily usable by models. Not all tagging data are equal in terms of length, area, and season of deployment. Fish are often tagged opportunistically, when and where they are accessible e.g. <span class="citation" data-cites="galuardi2012">Wilson et al. (<a href="#ref-wilson2015" role="doc-biblioref">2015</a>)</span>. Last, tagging data are expensive to collect and hold incredibly high scientific value. Allowing time for individual programs to publish results often means data are not quickly available for other purposes.</p>
<p>The solution to many of these issues is to simplify the manner in which the data are represented, and summarize it in an easily usable format. Empirical summaries by area and season offer the simplest method for incorporating many different data sources without compromising individuals information for other purposes <span class="citation" data-cites="carruthers2016a">(<a href="#ref-carruthers2016a" role="doc-biblioref">Carruthers et al. 2016b</a>)</span>. Simple summaries do not, however, take into account the uncertainties in the positions from which they were derived and do not deal effectively with the biases of short tracks in these datasets. A more robust method is to use individual based simulation, based on the tagging data, to produce movement probability metrics by season and area <span class="citation" data-cites="galuardi2014">(<a href="#ref-galuardi2014" role="doc-biblioref">B. Galuardi et al. 2014</a>)</span>. Here, we use several electronic tagging datasets, from the eastern and western Atlantic (Figure 1), to produce seasonal movement matrices for use in current and future operational and assessment models of Atlantic bluefin tuna. We use the 11-box model developed for the GBYP MSE <span class="citation" data-cites="carruthers2016a">(<a href="#ref-carruthers2016a" role="doc-biblioref">Carruthers et al. 2016b</a>)</span> as well as a simplified 4-box model. Simulation and matrix derivations were carried out using a custom package (SatTagSim) for the R statistical software <span class="citation" data-cites="rcoreteam2024">(<a href="#ref-rcoreteam2024" role="doc-biblioref">Team 2024</a>)</span>.</p>
<section id="elementssections" class="level2">
<h2 class="anchored" data-anchor-id="elementssections">elements/sections</h2>
<p>The best idea is to make the AFS 2017 talk into a chapter. It has all the elements it just need text. Basic textr can be used from the SCRS 2017 paper but the matrices, pieces, and interpretations are beyond what that paper offered.</p>
<ul>
<li><p>update SCRS 2017 paper with figures/text from using 3D parameters</p>
<ul>
<li>This was already done for the AFS 2017 talk!!</li>
<li>Use these figures: “C:\Users\benDrive\PHD\PUBS_TALKS\AFS2017\FIGS”</li>
<li>Use this script! “C:\Users\ben\Google Drive\PHD\COLLABORATIONS\AFS_2017_figs_8-8-17.r”</li>
</ul></li>
</ul>
<p>How many tracks were used? 170 east, 220 west E/W size split? how many sims were done? how was variance derived?</p>
<ul>
<li><p>Add E/W combination</p>
<ul>
<li>demonstrates sharing of movement parameters in the case of mixing</li>
</ul></li>
<li><p>use <span class="math inline">\(\chi^2\)</span> goodness of fit to compare transitions between small/large fish</p>
<ul>
<li><p>multinomial variance</p></li>
<li><p>use matrix variance example</p></li>
</ul></li>
<li><p>use <span class="math inline">\(\chi^2\)</span> goodness of fit to compare transitions between E/W</p></li>
</ul>
</section>
<section id="chapter-2-notes" class="level2">
<h2 class="anchored" data-anchor-id="chapter-2-notes">Chapter 2 notes</h2>
<ul>
<li>add visual of advection calculation</li>
<li>add method/demo of variance calculation</li>
<li>add method/demo of overall transition rate</li>
<li>add method/demo of comparison between two matrices</li>
<li>add functions to do comparisons</li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-carruthers2014" class="csl-entry" role="listitem">
Carruthers, Tom, and Campbell Davies. 2014. <span>“Evaluating Management Strategies for Atlantic Bluefin Tuna.”</span> <a href="http://www.iccat.int/GBYP/Documents/MODELLING/PHASE%205/MODELLING_PHASE5_CARRUTHERS_REPORT_1.pdf">http://www.iccat.int/GBYP/Documents/MODELLING/PHASE%205/MODELLING_PHASE5_CARRUTHERS_REPORT_1.pdf</a>.
</div>
<div id="ref-carruthers2016" class="csl-entry" role="listitem">
Carruthers, Tom, Ai Kimoto, Joseph E. Powers, Laurence Kell, Doug S. Butterworth, Matthew V. Lauretta, and Toshihide Kitakado. 2016a. <span>“Structure and Estimation Framework for Atlantic Bluefin Tuna Operating Models.”</span> <em>Collect. Vol. Sci. Pap. ICCAT</em> 72 (7): 17821795. <a href="https://www.iccat.int/Documents/CVSP/CV072_2016/n_7/CV07201782.pdf">https://www.iccat.int/Documents/CVSP/CV072_2016/n_7/CV07201782.pdf</a>.
</div>
<div id="ref-carruthers2016a" class="csl-entry" role="listitem">
———. 2016b. <span>“Structure and Estimation Framework for Atlantic Bluefin Tuna Operating Models.”</span> <em>Collect. Vol. Sci. Pap. ICCAT</em> 72 (7): 17821795. <a href="https://www.iccat.int/Documents/CVSP/CV072_2016/n_7/CV07201782.pdf">https://www.iccat.int/Documents/CVSP/CV072_2016/n_7/CV07201782.pdf</a>.
</div>
<div id="ref-cermeño2015" class="csl-entry" role="listitem">
Cermeño, Pablo, Gemma Quílez-Badia, Andrés Ospina-Alvarez, Susana Sainz-Trápaga, Andre M. Boustany, Andy C. Seitz, Sergi Tudela, and Barbara A. Block. 2015. <span>“Electronic Tagging of Atlantic Bluefin Tuna (Thunnus Thynnus, l.) Reveals Habitat Use and Behaviors in the Mediterranean Sea.”</span> <em>PLoS ONE</em> 10 (2). <a href="https://doi.org/10.1371/journal.pone.0116638">https://doi.org/10.1371/journal.pone.0116638</a>.
</div>
<div id="ref-galuardi2014" class="csl-entry" role="listitem">
Galuardi, B., S. X. Cadrin, L. Kerr, T. J. Miller, and M. Lutcavage. 2014. <span>“Using Electronic Tag Data to Provide Transition Matrices for Movement Inclusive Population Models.”</span> <em>ICCAT Collective Volume of Scientific Papers</em> 71 (4): 1746–56.
</div>
<div id="ref-galuardi2012" class="csl-entry" role="listitem">
Galuardi, Benjamin, and Molly Lutcavage. 2012. <span>“Dispersal Routes and Habitat Utilization of Juvenile Atlantic Bluefin Tuna, Thunnus Thynnus, Tracked with Mini PSAT and Archival Tags.”</span> <em>PLoS ONE</em> 7 (5). <a href="https://doi.org/10.1371/journal.pone.0037829">https://doi.org/10.1371/journal.pone.0037829</a>.
</div>
<div id="ref-kerr2016" class="csl-entry" role="listitem">
Kerr, Lisa A., Steven X. Cadrin, and David H. Secor. 2012b. <span>“Evaluating Population Effects and Management Implications of Mixing Between Eastern and Western Atlantic Bluefin Tuna Stocks.”</span> <em>ICES CM</em>, no. 13. <a href="http://www.ices.dk/sites/pub/CM%20Doccuments/CM-2012/N/N1312.pdf">http://www.ices.dk/sites/pub/CM%20Doccuments/CM-2012/N/N1312.pdf</a>.
</div>
<div id="ref-kerr2012a" class="csl-entry" role="listitem">
———. 2012a. <span>“Evaluating Population Effects and Management Implications of Mixing Between Eastern and Western Atlantic Bluefin Tuna Stocks.”</span> <em>ICES CM</em>, no. 13. <a href="http://www.ices.dk/sites/pub/CM%20Doccuments/CM-2012/N/N1312.pdf">http://www.ices.dk/sites/pub/CM%20Doccuments/CM-2012/N/N1312.pdf</a>.
</div>
<div id="ref-rcoreteam2024" class="csl-entry" role="listitem">
Team, R Core. 2024. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="http://www.R-project.org">http://www.R-project.org</a>.
</div>
<div id="ref-wilson2015" class="csl-entry" role="listitem">
Wilson, Steven G, Ian D Jonsen, Robert J Schallert, James E Ganong, Michael R Castleton, Aaron D Spares, Andre M. Boustany, Michael J. W. Stokesbury, and Barbara A. Block. 2015. <span>“Tracking the Fidelity of Atlantic Bluefin Tuna Released in Canadian Waters to the Gulf of Mexico Spawning Grounds.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em>, September. <a href="https://doi.org/10.1139/cjfas-2015-0110">https://doi.org/10.1139/cjfas-2015-0110</a>.
</div>
</div>
</section>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  
</body></html>